<!DOCTYPE html>
<html lang ="en">
<script src="https://code.jquery.com/jquery-1.9.1.js"></script>
<script>
    $(document).ready(
        retreivePost());
    async function retreivePost() {

        const response = await fetch("http://localhost:8080/api/get-next-post");
        const workouts = await response.json();
        
        //Pull exercises from backend
        const exercisesList = document.getElementById("js-content");
        for (let i = 0; i < workouts.length; i++) {
            var workoutdiv = document.createElement("div");
            workoutdiv.setAttribute("class", "workout");
            const image = await fetch("http://localhost:8080/api/get-playlist-picture?link="+workouts[i].playlistLink);
            const imageUrl = await image.text();
            console.log(image);
            workoutdiv.innerHTML += `
            <h3>
                    User: ${workouts[i].userName}
                    Date: ${workouts[i].date}, 
                    <br>
                    Playlist:
                    <br>
            </h3>
            <a href="${workouts[i].playlistLink}" target="_blank"><img src="${imageUrl}" alt="Playlist Cover" width="30%" height="30%" /></a>`;
            arrOnly = workouts[i]["exercises"]
            arrOnly.forEach(arrOnly => {
                workoutdiv.innerHTML += `
                    <li>
                        Exercise: ${arrOnly.name}, 
                        Weight: ${arrOnly.weight}, 
                        Reps: ${arrOnly.reps}, 
                        Sets: ${arrOnly.sets}
                    </li>`;
            });
            exercisesList.appendChild(workoutdiv);
        }
    }
    function retrieveUser() {

        fetch("http://localhost:8080/api/get-current-user")
        .then((response)=>response.text())
        .then(response => {document.getElementById("username").innerHTML = response;})
    //     var userReq = new XMLHttpRequest();
    //         userReq.open("POST", "http://localhost:8080/api/get-current-user", true);
    //         userReq.setRequestHeader('Content-Type', 'application/json');
    //         userReq.send(JSON.stringify());

    //     userReq.onreadystatechange = function () {
    //     if (this.readyState != 4) return;

    //     if (this.status == 200) {
    //         var data = JSON.parse(this.responseText);
    //         for(var i = 0; i < Object.keys(myObject).length; i++) {
    //             document.getElementById("username").innerHTML = data.name;
    //         }
    //     }
    // }
    }

</script>
<head>
    <meta charset=UTF-8">
    <title>GYMJAM</title>
    <link rel="stylesheet" href="scrollingpage.css">
</head>

<body>

    <div style="display: flex; justify-content: center;width: 100%;">
    <div class= "workout-holder">
        <div class="scroll" id="js-content">
            <!-- content will be loaded here -->
        

        </div>
    </div>
        <div class="movingbtn">
        <a href="addWorkout.html">
            <button type="button">Move to Workout</button></a>

            <button type="button" onclick="retreivePost()">Next Post</button>

        <a href="profilepage.html">
            <button  type="button">Look at profile</button></a>
        </div>

    </div>


</body>

</html>